var tweets,parentGroup=L.markerClusterGroup(),oracle=L.featureGroup.subGroup(parentGroup),mysql=L.featureGroup.subGroup(parentGroup),sqlserver=L.featureGroup.subGroup(parentGroup),postgres=L.featureGroup.subGroup(parentGroup),mongo=L.featureGroup.subGroup(parentGroup),ibm=L.featureGroup.subGroup(parentGroup),access=L.featureGroup.subGroup(parentGroup),redis=L.featureGroup.subGroup(parentGroup),elasticsearch=L.featureGroup.subGroup(parentGroup),sqlite=L.featureGroup.subGroup(parentGroup),enginesOverlay={'<i style="background: #D63E2A"></i>Oracle':oracle,'<i style="background: #0067A3"></i>MySQL':mysql,'<i style="background: #575757"></i>SQL Server':sqlserver,'<i style="background: #89DBFF"></i>PostgreSQL':postgres,'<i style="background: #72AF26"></i>MongoDB':mongo,'<i style="background: #303030"></i>IBM db2':ibm,'<i style="background: #A03336"></i>Microsoft Access':access,'<i style="background: #D63E2A"></i>Redis':redis,'<i style="background: orange"></i>Elasticsearch':elasticsearch,'<i style="background: #38AADD"></i>SQLite':sqlite},map=L.map("map",{maxZoom:16,layers:[oracle,mysql,sqlserver,postgres,mongo,ibm,access,redis,elasticsearch,sqlite]}).setView([20,0],2),lightMap=L.tileLayer("http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> & &copy; <a href="https://carto.com/attributions">CARTO</a>',maxZoom:16,minZoom:2.5,continuousWorld:!1}).addTo(map),nightMode=!1,nightmodeMap=L.tileLayer("http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> & &copy; <a href="https://carto.com/attributions">CARTO</a>',maxZoom:16,minZoom:2.5,continuousWorld:!1}),bounds=map.getBounds(),southWest=bounds.getSouthWest(),northEast=bounds.getNorthEast();bounds=L.latLngBounds(southWest,northEast),map.setMaxBounds(bounds),parentGroup.addTo(map),getDataAddMarkers=function({label:e,value:o,map:r,exclamation:t}){for(layer in enginesOverlay)enginesOverlay[layer].clearLayers();var a,s;"2 horas"==e?a="2hours":"4 horas"==e?a="4hours":"6 horas"==e&&(a="6hours"),tweets=$.ajax({url:"http://whosbest-twitter-map.app.di.ual.es/api/tweets/geolocation/true/since/"+a,dataType:"json",error:function(e){console.log(e.statusText)}}),$.when(tweets).done(function(){L.geoJson(tweets.responseJSON,{onEachFeature:function(e,o){s=!0,-1!==jQuery.inArray("Oracle",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"red"})),o.addTo(oracle)):-1!==jQuery.inArray("MySQL",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"darkblue"})),o.addTo(mysql)):-1!==jQuery.inArray("SQL Server",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"gray"})),o.addTo(sqlserver)):-1!==jQuery.inArray("PostgreSQL",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"lightblue"})),o.addTo(postgres)):-1!==jQuery.inArray("MongoDB",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"green"})),o.addTo(mongo)):-1!==jQuery.inArray("IBM db2",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"black"})),o.addTo(ibm)):-1!==jQuery.inArray("Access",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"darkred"})),o.addTo(access)):-1!==jQuery.inArray("Redis",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"red"})),o.addTo(redis)):-1!==jQuery.inArray("Elasticsearch",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"orange"})),o.addTo(elasticsearch)):-1!==jQuery.inArray("SQLite",e.properties.topics)?(o.setIcon(L.AwesomeMarkers.icon({icon:"null",markerColor:"blue"})),o.addTo(sqlite)):s=!1,s&&o.bindPopup("<blockquote class=twitter-tweet data-cards=hidden data-conversation=none data-lang=es><p lang="+e.properties.lang+"dir=ltr>"+e.properties.text+"</p>&mdash;"+e.properties.user_name+"<a href=https://twitter.com/"+e.properties.user_name+"/status/"+e.properties.id+">"+e.properties.date+"</a></blockquote>",{minWidth:215,autoClose:!0,closeOnClick:!0}).on("click",clickZoom)}})})},L.control.layers(null,enginesOverlay,{collapsed:!1}).addTo(map),L.control.timelineSlider({position:"bottomleft",timelineItems:["6 horas","4 horas","2 horas"],changeMap:getDataAddMarkers}).addTo(map),map.addControl(L.control.locate({locateOptions:{maxZoom:7}})),map.addControl(new L.Control.Fullscreen);var nightModeControl=L.Control.extend({options:{position:"topleft"},onAdd:function(e){var o=L.DomUtil.create("div","leaflet-bar leaflet-control leaflet-control-custom");return o.style.backgroundColor="white",o.style.backgroundImage="url(images/moon-solid.svg)",o.style.backgroundRepeat="no-repeat",o.style.backgroundPosition="center",o.style.backgroundSize="20px 20px",o.style.width="30px",o.style.height="30px",o.style.cursor="pointer",o.title="Modo oscuro",o.onclick=function(){nightMode?(e.removeLayer(nightmodeMap),e.addLayer(lightMap),nightMode=!1):(e.removeLayer(lightMap),e.addLayer(nightmodeMap),nightMode=!0)},o}});function clickZoom(e){$.getScript("https://platform.twitter.com/widgets.js"),$(".leaflet-popup").hide(),setTimeout(function(){$(".leaflet-popup").show()},1050)}map.addControl(new nightModeControl),map.addControl(new L.Control.Search({url:"https://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],marker:{},hideMarkerOnCollapse:!0,autoCollapse:!1,autoType:!1,minLength:2,zoom:8,textErr:"Ubicación no encontrada",textCancel:"Cancelar",textPlaceholder:"Buscar ubicación"})),map.on("popupopen",function(e){var o=map.project(e.popup._latlng);o.y-=e.popup._container.clientHeight/2,map.panTo(map.unproject(o),{animate:!0})});